# ğŸ¨ MY HOST BIZMATE - ARQUITECTURA COMPLETA

## ğŸ“Š VISIÃ“N GENERAL DEL SISTEMA

```
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                                                                                        â•‘
â•‘                           ğŸŒ CANALES DE ENTRADA (LEADS)                                â•‘
â•‘                                                                                        â•‘
â•‘    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â•‘
â•‘    â”‚ WhatsApp â”‚  â”‚   Web    â”‚  â”‚Instagram â”‚  â”‚ Facebook â”‚  â”‚  TikTok  â”‚  â”‚  Voice   â”‚ â•‘
â•‘    â”‚    âœ…    â”‚  â”‚    â³    â”‚  â”‚    â³    â”‚  â”‚    â³    â”‚  â”‚    â³    â”‚  â”‚    âœ…    â”‚ â•‘
â•‘    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜ â•‘
â•‘         â”‚             â”‚             â”‚             â”‚             â”‚             â”‚        â•‘
â•‘         â”‚             â”‚             â”‚             â”‚             â”‚             â”‚        â•‘
â•‘         â–¼             â–¼             â–¼             â–¼             â–¼             â–¼        â•‘
â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
â•‘                                                                                        â•‘
â•‘                              ğŸ¤– CAPA DE AI ASSISTANTS                                  â•‘
â•‘                                                                                        â•‘
â•‘  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â•‘
â•‘  â”‚      WHATSAPP AI CONCIERGE      â”‚              â”‚        VAPI VOICE ASSISTANT     â”‚  â•‘
â•‘  â”‚            âœ… ACTIVO            â”‚              â”‚            âœ… ACTIVO            â”‚  â•‘
â•‘  â”‚                                 â”‚              â”‚                                 â”‚  â•‘
â•‘  â”‚  â€¢ Responde consultas 24/7      â”‚              â”‚  â€¢ Atiende llamadas 24/7        â”‚  â•‘
â•‘  â”‚  â€¢ Disponibilidad y precios     â”‚              â”‚  â€¢ Responde preguntas           â”‚  â•‘
â•‘  â”‚  â€¢ Clasifica intenciÃ³n (intent) â”‚              â”‚  â€¢ Genera transcripts           â”‚  â•‘
â•‘  â”‚  â€¢ Extrae: noches, villas,      â”‚              â”‚  â€¢ Puede crear leads            â”‚  â•‘
â•‘  â”‚    descuento, high_value        â”‚              â”‚                                 â”‚  â•‘
â•‘  â”‚  â€¢ Escala a humano si necesario â”‚              â”‚  Tel: +62 813 2576 4867         â”‚  â•‘
â•‘  â”‚                                 â”‚              â”‚                                 â”‚  â•‘
â•‘  â”‚  API: Chakra HQ (WhatsApp BSP)  â”‚              â”‚  API: VAPI.ai                   â”‚  â•‘
â•‘  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â•‘
â•‘                  â”‚                                                â”‚                    â•‘
â•‘                  â”‚         CREA / ACTUALIZA LEAD                  â”‚                    â•‘
â•‘                  â”‚                                                â”‚                    â•‘
â•‘                  â–¼                                                â–¼                    â•‘
â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
â•‘                                                                                        â•‘
â•‘                          ğŸ“ WF-01: INBOUND LEAD HANDLER                                â•‘
â•‘                                    â³ PENDIENTE MULTICANAL                             â•‘
â•‘                                                                                        â•‘
â•‘  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â•‘
â•‘  â”‚                                                                                  â”‚  â•‘
â•‘  â”‚   FUNCIÃ“N: Normalizar TODOS los leads a un formato Ãºnico                         â”‚  â•‘
â•‘  â”‚                                                                                  â”‚  â•‘
â•‘  â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚  â•‘
â•‘  â”‚   â”‚ Channel Adapter â”‚â”€â”€â”€â–¶â”‚  Normalize to   â”‚â”€â”€â”€â–¶â”‚    Dedupe &     â”‚              â”‚  â•‘
â•‘  â”‚   â”‚  (por canal)    â”‚    â”‚  Lead Object    â”‚    â”‚  Insert/Update  â”‚              â”‚  â•‘
â•‘  â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚  â•‘
â•‘  â”‚                                                          â”‚                       â”‚  â•‘
â•‘  â”‚   DEDUPE RULES:                                          â”‚                       â”‚  â•‘
â•‘  â”‚   1. phone_e164 (prioritario)                            â”‚                       â”‚  â•‘
â•‘  â”‚   2. email                                               â”‚                       â”‚  â•‘
â•‘  â”‚   3. channel + channel_user_id                           â”‚                       â”‚  â•‘
â•‘  â”‚   4. channel + anonymous hash                            â–¼                       â”‚  â•‘
â•‘  â”‚                                                                                  â”‚  â•‘
â•‘  â”‚   ESCRIBE:                      NO HACE:                                         â”‚  â•‘
â•‘  â”‚   â€¢ lead_id                     â€¢ Follow-ups                                     â”‚  â•‘
â•‘  â”‚   â€¢ state = NEW                 â€¢ Timers                                         â”‚  â•‘
â•‘  â”‚   â€¢ last_inbound_at = now()     â€¢ Notificar owner                                â”‚  â•‘
â•‘  â”‚   â€¢ next_followup_at = +24h     â€¢ Reglas de negocio                              â”‚  â•‘
â•‘  â”‚   â€¢ channel, intent, etc.       â€¢ Marcar LOST/WON                                â”‚  â•‘
â•‘  â”‚                                                                                  â”‚  â•‘
â•‘  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â•‘
â•‘                                           â”‚                                            â•‘
â•‘                                           â”‚ ESCRIBE                                    â•‘
â•‘                                           â–¼                                            â•‘
â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
â•‘                                                                                        â•‘
â•‘                          ğŸ’¾ SUPABASE (BASE DE DATOS CENTRAL)                           â•‘
â•‘                                      âœ… ACTIVO                                         â•‘
â•‘                                                                                        â•‘
â•‘  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â•‘
â•‘  â”‚                                                                                  â”‚  â•‘
â•‘  â”‚   ğŸ“‹ TABLA: leads                        ğŸ“‹ TABLA: lead_events                   â”‚  â•‘
â•‘  â”‚   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                      â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                     â”‚  â•‘
â•‘  â”‚   â€¢ id (UUID)                            â€¢ id                                    â”‚  â•‘
â•‘  â”‚   â€¢ property_id                          â€¢ lead_id                               â”‚  â•‘
â•‘  â”‚   â€¢ lead_key (dedupe)                    â€¢ property_id                           â”‚  â•‘
â•‘  â”‚   â€¢ channel                              â€¢ event_type                            â”‚  â•‘
â•‘  â”‚   â€¢ phone_e164                           â€¢ channel                               â”‚  â•‘
â•‘  â”‚   â€¢ name                                 â€¢ followup_step                         â”‚  â•‘
â•‘  â”‚   â€¢ state â­                             â€¢ meta (JSON)                           â”‚  â•‘
â•‘  â”‚   â€¢ intent                               â€¢ occurred_at                           â”‚  â•‘
â•‘  â”‚   â€¢ stay_nights                                                                  â”‚  â•‘
â•‘  â”‚   â€¢ villas_count                         ğŸ“‹ TABLA: properties                    â”‚  â•‘
â•‘  â”‚   â€¢ requested_discount                   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                    â”‚  â•‘
â•‘  â”‚   â€¢ high_value                           â€¢ id                                    â”‚  â•‘
â•‘  â”‚   â€¢ language                             â€¢ name                                  â”‚  â•‘
â•‘  â”‚   â€¢ followup_step                        â€¢ owner_phone                           â”‚  â•‘
â•‘  â”‚   â€¢ last_inbound_at                      â€¢ whatsapp_number                       â”‚  â•‘
â•‘  â”‚   â€¢ last_outbound_at                     â€¢ followup_enabled                      â”‚  â•‘
â•‘  â”‚   â€¢ next_followup_at â­                                                          â”‚  â•‘
â•‘  â”‚   â€¢ last_owner_notified_at                                                       â”‚  â•‘
â•‘  â”‚   â€¢ closed_at                                                                    â”‚  â•‘
â•‘  â”‚                                                                                  â”‚  â•‘
â•‘  â”‚   â­ = Campos clave para la conexiÃ³n WF-01 â†” WF-02                               â”‚  â•‘
â•‘  â”‚                                                                                  â”‚  â•‘
â•‘  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â•‘
â•‘                                           â”‚                                            â•‘
â•‘                                           â”‚ LEE (cada hora)                            â•‘
â•‘                                           â”‚ WHERE next_followup_at <= now()            â•‘
â•‘                                           â”‚ AND state NOT IN ('WON','LOST')            â•‘
â•‘                                           â–¼                                            â•‘
â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
â•‘                                                                                        â•‘
â•‘                           â° WF-02: FOLLOW-UP ENGINE v8                                â•‘
â•‘                                    âœ… ACTIVO                                           â•‘
â•‘                                                                                        â•‘
â•‘  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â•‘
â•‘  â”‚                                                                                  â”‚  â•‘
â•‘  â”‚   TRIGGER: CRON cada hora                                                        â”‚  â•‘
â•‘  â”‚                                                                                  â”‚  â•‘
â•‘  â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚  â•‘
â•‘  â”‚   â”‚  Query  â”‚â”€â”€â”€â–¶â”‚ Compute â”‚â”€â”€â”€â–¶â”‚   AI    â”‚â”€â”€â”€â–¶â”‚  Send   â”‚â”€â”€â”€â–¶â”‚ Update  â”‚        â”‚  â•‘
â•‘  â”‚   â”‚  Due    â”‚    â”‚Decision â”‚    â”‚ Agent   â”‚    â”‚WhatsApp â”‚    â”‚  Lead   â”‚        â”‚  â•‘
â•‘  â”‚   â”‚ Leads   â”‚    â”‚         â”‚    â”‚(GPT-4.1)â”‚    â”‚         â”‚    â”‚         â”‚        â”‚  â•‘
â•‘  â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜        â”‚  â•‘
â•‘  â”‚                                                                    â”‚             â”‚  â•‘
â•‘  â”‚                                                                    â–¼             â”‚  â•‘
â•‘  â”‚   TIMELINE DE FOLLOW-UPS:                              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚  â•‘
â•‘  â”‚   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                            â”‚ Notify Owner?   â”‚       â”‚  â•‘
â•‘  â”‚                                                        â”‚                 â”‚       â”‚  â•‘
â•‘  â”‚   Step 1: +24h  â†’ SOFT_CHECK                           â”‚ SI cuando:      â”‚       â”‚  â•‘
â•‘  â”‚   Step 2: +48h  â†’ VALUE_REMINDER                       â”‚ â€¢ high_value    â”‚       â”‚  â•‘
â•‘  â”‚   Step 3: +72h  â†’ LAST_DIRECT                          â”‚ â€¢ discount      â”‚       â”‚  â•‘
â•‘  â”‚   Step 4: +7d   â†’ REENGAGEMENT                         â”‚ â€¢ state = HOT   â”‚       â”‚  â•‘
â•‘  â”‚   Step 5: +14d  â†’ INCENTIVE                            â”‚ â€¢ step 6 (LOST) â”‚       â”‚  â•‘
â•‘  â”‚   Step 6: FINAL â†’ CLOSURE â†’ LOST                       â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚  â•‘
â•‘  â”‚                                                                 â”‚                â”‚  â•‘
â•‘  â”‚                                                                 â–¼                â”‚  â•‘
â•‘  â”‚   PERSONALIZACIÃ“N AI:                                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚  â•‘
â•‘  â”‚   â€¢ Usa nombre del lead                                â”‚  Send Owner WA  â”‚       â”‚  â•‘
â•‘  â”‚   â€¢ Menciona noches/villas                             â”‚                 â”‚       â”‚  â•‘
â•‘  â”‚   â€¢ Tono VIP si high_value                             â”‚  ğŸ”” LEAD ALERT  â”‚       â”‚  â•‘
â•‘  â”‚   â€¢ Idioma: espaÃ±ol/inglÃ©s                             â”‚  Lead: [nombre] â”‚       â”‚  â•‘
â•‘  â”‚   â€¢ Firma del hotel al final                           â”‚  Phone: [tel]   â”‚       â”‚  â•‘
â•‘  â”‚                                                        â”‚  State: [estado]â”‚       â”‚  â•‘
â•‘  â”‚                                                        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚  â•‘
â•‘  â”‚   NO HACE:                                                                       â”‚  â•‘
â•‘  â”‚   â€¢ Recibir webhooks                                                             â”‚  â•‘
â•‘  â”‚   â€¢ Crear leads nuevos                                                           â”‚  â•‘
â•‘  â”‚   â€¢ Manejar inbound                                                              â”‚  â•‘
â•‘  â”‚                                                                                  â”‚  â•‘
â•‘  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â•‘
â•‘                                                                                        â•‘
â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
â•‘                                                                                        â•‘
â•‘                              ğŸ“± SALIDAS / NOTIFICACIONES                               â•‘
â•‘                                                                                        â•‘
â•‘    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â•‘
â•‘    â”‚      MENSAJE AL CLIENTE        â”‚         â”‚      NOTIFICACIÃ“N AL OWNER     â”‚      â•‘
â•‘    â”‚                                â”‚         â”‚                                â”‚      â•‘
â•‘    â”‚  Via: WhatsApp (Chakra HQ)     â”‚         â”‚  Via: WhatsApp (Chakra HQ)     â”‚      â•‘
â•‘    â”‚                                â”‚         â”‚                                â”‚      â•‘
â•‘    â”‚  "Dear Robert Chen, I wanted   â”‚         â”‚  ğŸ”” LEAD ALERT                 â”‚      â•‘
â•‘    â”‚   to kindly check in regarding â”‚         â”‚  Lead: Robert Chen             â”‚      â•‘
â•‘    â”‚   your plans to stay with us   â”‚         â”‚  Phone: +34619794604           â”‚      â•‘
â•‘    â”‚   for seven nights..."         â”‚         â”‚  State: HOT                    â”‚      â•‘
â•‘    â”‚                                â”‚         â”‚  Nights: 7 | Villas: 3         â”‚      â•‘
â•‘    â”‚                                â”‚         â”‚  âš¡ Action Required            â”‚      â•‘
â•‘    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â•‘
â•‘                                                                                        â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
```

---

## ğŸ”„ MÃQUINA DE ESTADOS DEL LEAD

```
                                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                    â”‚           CICLO DE VIDA             â”‚
                                    â”‚             DEL LEAD                â”‚
                                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚   NEW   â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚   WON   â”‚
    â”‚         â”‚        (Cliente reserva en cualquier momento)             â”‚   âœ…    â”‚
    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜                                                           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚                                                                     â–²
         â”‚ Lead responde                                                       â”‚
         â–¼                                                                     â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                                â”‚
    â”‚ ENGAGED â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
    â”‚         â”‚        (Cliente reserva en cualquier momento)                  â”‚
    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜                                                                â”‚
         â”‚                                                                     â”‚
         â”‚ Muestra intenciÃ³n seria                                             â”‚
         â”‚ (pregunta precios, fechas especÃ­ficas)                              â”‚
         â–¼                                                                     â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                                â”‚
    â”‚   HOT   â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚   ğŸ”¥    â”‚        (Cliente reserva)
    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
         â”‚
         â”‚ No responde, WF-02 hace follow-up
         â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ FOLLOWING_UPâ”‚
    â”‚             â”‚
    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â”‚ 6 intentos sin respuesta
           â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  LOST   â”‚
    â”‚   âŒ    â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”— CONEXIÃ“N ENTRE WORKFLOWS (EL SECRETO)

```
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                                                                                        â•‘
â•‘   âš ï¸  WF-01 Y WF-02 NUNCA SE LLAMAN DIRECTAMENTE                                       â•‘
â•‘                                                                                        â•‘
â•‘   La "conexiÃ³n" es a travÃ©s de TIMESTAMPS en la base de datos                          â•‘
â•‘                                                                                        â•‘
â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
â•‘                                                                                        â•‘
â•‘                                                                                        â•‘
â•‘   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â•‘
â•‘   â”‚       WF-01         â”‚                           â”‚       WF-02         â”‚            â•‘
â•‘   â”‚  (Inbound Handler)  â”‚                           â”‚  (Follow-Up Engine) â”‚            â•‘
â•‘   â”‚                     â”‚                           â”‚                     â”‚            â•‘
â•‘   â”‚  Trigger: Webhook   â”‚                           â”‚  Trigger: CRON      â”‚            â•‘
â•‘   â”‚  (mensaje entrante) â”‚                           â”‚  (cada hora)        â”‚            â•‘
â•‘   â”‚                     â”‚                           â”‚                     â”‚            â•‘
â•‘   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â•‘
â•‘              â”‚                                                 â”‚                       â•‘
â•‘              â”‚ ESCRIBE:                                        â”‚ LEE:                  â•‘
â•‘              â”‚ â€¢ state = 'NEW'                                 â”‚ â€¢ WHERE state NOT IN  â•‘
â•‘              â”‚ â€¢ last_inbound_at = now()                       â”‚   ('WON', 'LOST')     â•‘
â•‘              â”‚ â€¢ next_followup_at = now() + 24h  â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚ â€¢ AND next_followup_atâ•‘
â•‘              â”‚                                      ESTA ES    â”‚   <= now()            â•‘
â•‘              â–¼                                    LA CONEXIÃ“N  â–¼                       â•‘
â•‘   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â•‘
â•‘   â”‚                                                                              â”‚    â•‘
â•‘   â”‚                              SUPABASE                                        â”‚    â•‘
â•‘   â”‚                                                                              â”‚    â•‘
â•‘   â”‚    leads.next_followup_at = '2026-01-07 11:00:00'                           â”‚    â•‘
â•‘   â”‚                                                                              â”‚    â•‘
â•‘   â”‚    WF-02 a las 11:00: "Ah, este lead ya estÃ¡ due, lo proceso"               â”‚    â•‘
â•‘   â”‚                                                                              â”‚    â•‘
â•‘   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â•‘
â•‘                                                                                        â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
```

---

## âœ… ESTADO ACTUAL vs PENDIENTE

```
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                         ESTADO DEL PROYECTO                               â•‘
â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
â•‘                                                                           â•‘
â•‘   âœ… OPERATIVO                          â³ PENDIENTE                       â•‘
â•‘   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                          â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                       â•‘
â•‘                                                                           â•‘
â•‘   â€¢ WhatsApp AI Concierge               â€¢ WF-01 Multicanal                â•‘
â•‘   â€¢ VAPI Voice Assistant                  - Web forms                     â•‘
â•‘   â€¢ WF-02 Follow-Up Engine v8             - Instagram DMs                 â•‘
â•‘   â€¢ Supabase (leads + events)             - Facebook Messenger            â•‘
â•‘   â€¢ Notificaciones al Owner               - TikTok leads                  â•‘
â•‘   â€¢ Timeline 6 pasos                    â€¢ Channel Adapters                â•‘
â•‘   â€¢ PersonalizaciÃ³n AI                  â€¢ Test Mode (test_mode: true)     â•‘
â•‘   â€¢ Soporte multiidioma                 â€¢ Plan de Pruebas completo        â•‘
â•‘   â€¢ Firma del hotel                     â€¢ WhatsApp Concierge Enrichment   â•‘
â•‘   â€¢ CLOSURE â†’ LOST con notify             - Signal extraction             â•‘
â•‘                                           - Load context to AI            â•‘
â•‘                                                                           â•‘
â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
â•‘                                                                           â•‘
â•‘   ğŸ“ IZUMI HOTEL (Piloto)                                                 â•‘
â•‘   Property ID: 18711359-1378-4d12-9ea6-fb31c0b1bac2                       â•‘
â•‘   WhatsApp: +62 813 2576 4867                                             â•‘
â•‘   Owner Test Phone: +34 619 794 604                                       â•‘
â•‘                                                                           â•‘
â•‘   ğŸ”§ INFRAESTRUCTURA                                                      â•‘
â•‘   n8n: https://n8n-production-bb2d.up.railway.app                         â•‘
â•‘   Supabase: https://jjpscimtxrudtepzwhag.supabase.co                      â•‘
â•‘   WhatsApp API: Chakra HQ                                                 â•‘
â•‘                                                                           â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
```

---

## ğŸ¯ PRÃ“XIMOS PASOS (ORDEN RECOMENDADO)

```
â”Œâ”€â”€â”€â”€â”€â”
â”‚  1  â”‚  WF-01 MULTICANAL
â””â”€â”€â”¬â”€â”€â”˜  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   â”‚     Crear webhook unificado que reciba:
   â”‚     â€¢ Web forms â†’ channel: "web"
   â”‚     â€¢ Instagram â†’ channel: "instagram"  
   â”‚     â€¢ Facebook â†’ channel: "facebook"
   â”‚     â€¢ TikTok â†’ channel: "tiktok"
   â”‚     
   â”‚     Normalizar todos al mismo Lead Object
   â”‚     
   â–¼
â”Œâ”€â”€â”€â”€â”€â”
â”‚  2  â”‚  TEST PLAN COMPLETO
â””â”€â”€â”¬â”€â”€â”˜  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   â”‚     â€¢ Simular cada canal con test_mode: true
   â”‚     â€¢ Validar dedupe funciona
   â”‚     â€¢ Validar WF-02 recoge los leads
   â”‚     â€¢ End-to-end: Web lead â†’ Follow-ups â†’ LOST/WON
   â”‚     
   â–¼
â”Œâ”€â”€â”€â”€â”€â”
â”‚  3  â”‚  WHATSAPP CONCIERGE ENRICHMENT
â””â”€â”€â”¬â”€â”€â”˜  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   â”‚     â€¢ Extraer seÃ±ales: wants_to_book, hesitation
   â”‚     â€¢ Inyectar contexto del lead al AI
   â”‚     â€¢ Mejorar clasificaciÃ³n de intenciÃ³n
   â”‚     
   â–¼
â”Œâ”€â”€â”€â”€â”€â”
â”‚  4  â”‚  INTEGRACIONES REALES (META + TIKTOK)
â””â”€â”€â”€â”€â”€â”˜  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
         Solo cuando todo lo anterior estÃ© validado
         â€¢ Configurar webhooks en Meta Business
         â€¢ Configurar TikTok Lead Forms
         â€¢ Los Channel Adapters ya estarÃ¡n listos
```
