<!DOCTYPE html>
<html>
<head>
  <title>Test Supabase Session</title>
</head>
<body>
  <h1>Supabase Session Test</h1>
  <p>Open browser console to see results</p>

  <script type="module">
    import { createClient } from 'https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/+esm'

    const supabaseUrl = 'https://jjpscimtxrudtepzwhag.supabase.co'
    const supabaseAnonKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImpqcHNjaW10eHJ1ZHRlcHp3aGFnIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjI5NDMyMzIsImV4cCI6MjA3ODUxOTIzMn0._U_HwdF5-yT8-prJLzkdO_rGbNuu7Z3gpUQW0Q8zxa0'

    const supabase = createClient(supabaseUrl, supabaseAnonKey, {
      auth: {
        autoRefreshToken: true,
        persistSession: true,
        detectSessionInUrl: true,
        storageKey: 'sb-jjpscimtxrudtepzwhag-auth-token',
        storage: window.localStorage
      }
    })

    console.log('ğŸ” Testing Supabase Session...')

    // Test 1: Check session
    const { data: { session }, error: sessionError } = await supabase.auth.getSession()
    console.log('âœ… Session:', session)
    console.log('âŒ Session Error:', sessionError)

    if (session) {
      console.log('ğŸ”‘ Access Token:', session.access_token.substring(0, 50) + '...')
      console.log('ğŸ‘¤ User ID:', session.user.id)
      console.log('ğŸ“§ Email:', session.user.email)

      // Test 2: Check if token is sent in queries
      console.log('\nğŸ” Testing RLS context...')
      const { data: rlsData, error: rlsError } = await supabase.rpc('test_rls_context')
      console.log('âœ… RLS Test Result:', rlsData)
      console.log('âŒ RLS Test Error:', rlsError)

      // Test 3: Query bookings
      console.log('\nğŸ” Testing bookings query...')
      const { data: bookings, error: bookingsError } = await supabase
        .from('bookings')
        .select('id, guest_name, tenant_id')
        .limit(5)
      console.log('âœ… Bookings:', bookings)
      console.log('âŒ Bookings Error:', bookingsError)
      console.log('ğŸ“Š Count:', bookings?.length || 0)
    } else {
      console.log('âš ï¸ No session found - user not logged in')
    }
  </script>
</body>
</html>
