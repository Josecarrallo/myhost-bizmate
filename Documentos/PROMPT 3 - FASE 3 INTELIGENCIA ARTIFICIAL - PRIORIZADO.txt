PROMPT 3 ‚Äì FASE 3: INTELIGENCIA ARTIFICIAL (12 AGENTES IA)
========================================================================

CONTEXTO:
---------
FASE 1 completada ‚úÖ (04 DIC 2025)
FASE 2 completada ‚úÖ (Backend + Supabase CRUD)

Ahora implementamos los 12 Agentes de Inteligencia Artificial para automatizar
el 80-90% de las operaciones del PMS.

Este prompt est√° PRIORIZADO en 3 fases:
- FASE 3A: MVP (3 agentes cr√≠ticos) - SEMANA 1
- FASE 3B: EXPANSI√ìN (3 agentes importantes) - SEMANA 2
- FASE 3C: COMPLETO (6 agentes complementarios) - SEMANA 3-4

STACK T√âCNICO:
--------------
- IA: Claude 3.5 Sonnet (Anthropic API)
- Automatizaci√≥n: n8n (workflows)
- WhatsApp: WhatsApp Business API + Cloud API
- Integraci√≥n: Supabase Functions + Webhooks
- Frontend: React 18 (ya existe)

========================================================================
FASE 3A: MVP - 3 AGENTES CR√çTICOS (SEMANA 1)
========================================================================

OBJETIVO: Sistema IA funcional atendiendo hu√©spedes y optimizando revenue.

----------------------------
ü§ñ AGENTE 9: WhatsApp Hospitality Concierge Agent (PRIORIDAD M√ÅXIMA)
----------------------------

DESCRIPCI√ìN:
Agente IA que atiende consultas de hu√©spedes v√≠a WhatsApp 24/7 en m√∫ltiples idiomas,
proporcionando informaci√≥n sobre la villa, recomendaciones locales, check-in/out,
y resolviendo problemas durante la estancia.

CAPACIDADES:
‚úì Responder preguntas sobre la villa (amenities, WiFi, reglas)
‚úì Dar recomendaciones de restaurantes, actividades, tours
‚úì Informaci√≥n de check-in/check-out (horarios, access codes)
‚úì Resolver problemas durante estancia (AC no funciona, WiFi lento)
‚úì Procesar solicitudes (toallas extra, early check-in, late check-out)
‚úì Multilingual: Ingl√©s, Espa√±ol, Franc√©s, Alem√°n, Japon√©s, Chino
‚úì Escalar a humano si no puede resolver

CONTEXTO QUE MANEJA:
- Booking del hu√©sped (property, dates, guests)
- Property info (amenities, rules, WiFi, access codes)
- Base de conocimiento de recomendaciones locales
- Staff disponible (para escalamiento)

TECNOLOG√çA:
- WhatsApp Business API + Cloud API
- Claude 3.5 Sonnet con function calling
- n8n workflow: webhook ‚Üí Claude ‚Üí respuesta
- Supabase: guardar historial de conversaciones

TABLA: whatsapp_conversations
- id (UUID, PK)
- booking_id (UUID, FK, nullable)
- phone_number (TEXT)
- guest_name (TEXT)
- message (TEXT)
- response (TEXT)
- ai_handled (BOOLEAN)
- escalated (BOOLEAN)
- escalated_to (UUID, FK a users)
- sentiment (ENUM: positive, neutral, negative)
- created_at (TIMESTAMP)

n8n WORKFLOW:
1. Webhook recibe mensaje WhatsApp
2. Identificar booking por phone_number
3. Cargar contexto (booking + property + knowledge base)
4. Llamar Claude con contexto + historial
5. Claude genera respuesta (o decide escalar)
6. Enviar respuesta por WhatsApp
7. Guardar conversaci√≥n en DB

PROMPT SYSTEM:
```
Eres el Concierge IA de [Property Name], un asistente experto en hospitalidad
que ayuda a hu√©spedes antes, durante y despu√©s de su estancia en Bali.

INFORMACI√ìN DEL HU√âSPED:
- Nombre: {guest_name}
- Check-in: {check_in}
- Check-out: {check_out}
- Property: {property_name}

INFORMACI√ìN DE LA VILLA:
- WiFi: {wifi_password}
- Access Code: {access_code}
- Amenities: {amenities}
- House Rules: {house_rules}

RECOMENDACIONES LOCALES:
{knowledge_base_restaurants}
{knowledge_base_activities}
{knowledge_base_transport}

TU ROL:
- Ser amigable, profesional y proactivo
- Responder en el idioma del hu√©sped
- Dar recomendaciones personalizadas
- Resolver problemas r√°pidamente
- Escalar a staff si: emergencia, solicitud fuera de tu capacidad, problema t√©cnico complejo

FORMATO DE RESPUESTA:
- Breve y conciso (m√°x 3 p√°rrafos)
- Usa emojis apropiados
- Incluye links/mapas si es relevante
```

FUNCIONES DISPONIBLES (function calling):
- get_property_info(property_id)
- get_booking_details(booking_id)
- get_local_recommendations(category, location)
- create_maintenance_issue(property_id, description)
- escalate_to_human(reason, urgency)
- send_access_code(booking_id)

CRITERIO √âXITO:
‚úì 80% de consultas resueltas sin intervenci√≥n humana
‚úì Tiempo respuesta < 30 segundos
‚úì Satisfacci√≥n hu√©sped > 4.5/5
‚úì 100 conversaciones reales gestionadas

----------------------------
ü§ñ AGENTE 2: Booking Manager Agent
----------------------------

DESCRIPCI√ìN:
Agente que procesa reservas autom√°ticamente: valida disponibilidad, calcula precio,
env√≠a confirmaciones, gestiona pagos, y comunica con el hu√©sped pre-llegada.

CAPACIDADES:
‚úì Recibir inquiries de m√∫ltiples canales (WhatsApp, email, web)
‚úì Validar disponibilidad en tiempo real
‚úì Calcular precio con reglas de pricing
‚úì Crear booking en Supabase
‚úì Enviar confirmaci√≥n por email/WhatsApp
‚úì Gestionar pagos (generar link de Stripe)
‚úì Enviar recordatorios pre-llegada (48h antes)
‚úì Coordinar con Digital Check-in Agent

TECNOLOG√çA:
- n8n workflows
- Claude para decisiones inteligentes
- Supabase Functions
- Stripe para pagos
- Email (SendGrid/Resend) + WhatsApp

n8n WORKFLOWS:

WORKFLOW 1: Nueva Inquiry
1. Webhook recibe inquiry (web form, WhatsApp, email)
2. Claude extrae: dates, guests, preferences
3. Check availability (Supabase function)
4. Calculate price (pricing rules + seasonal adjustments)
5. Claude genera respuesta personalizada
6. Enviar quote por WhatsApp/email
7. Guardar inquiry en bookings (status='inquiry')

WORKFLOW 2: Confirmaci√≥n de Booking
1. Hu√©sped confirma (responde "Yes" o click en link)
2. Crear booking definitivo (status='confirmed')
3. Generar payment link (Stripe)
4. Enviar confirmaci√≥n con:
   - Booking details
   - Payment link
   - House rules
   - Parking info
5. Agregar a calendario
6. Trigger Digital Check-in (enviar link 48h antes)

WORKFLOW 3: Reminder Pre-Llegada
1. Cron job: daily at 10am
2. Query bookings con check-in en 48h
3. Para cada booking:
   - Verificar si complet√≥ check-in digital
   - Enviar reminder por WhatsApp:
     * Link check-in digital
     * Arrival instructions
     * Contact info
4. Si no responde en 24h ‚Üí escalar a humano

PROMPT SYSTEM (Booking Agent):
```
Eres el Booking Manager de MY HOST BizMate, un agente profesional que gestiona
reservas de propiedades vacacionales en Bali.

TU ROL:
- Responder inquiries r√°pidamente (< 5 min)
- Calcular precios precisos considerando todos los factores
- Ser persuasivo pero honesto
- Confirmar todos los detalles claramente
- Coordinar con otros agentes (Check-in, Housekeeping)

CONTEXTO:
{property_details}
{availability_calendar}
{pricing_rules}
{current_season}

DECISIONES QUE TOMAS:
- Aceptar/rechazar booking seg√∫n criterios
- Aplicar descuentos (siguiendo reglas)
- Ofrecer propiedades alternativas si no hay disponibilidad
- Escalar a owner si: solicitud especial compleja, grupo grande, precio fuera de rango

FORMATO RESPUESTAS:
- Profesional y c√°lido
- Incluir siempre: precio total, dates, guests, property
- CTA claro (confirmar, pagar, etc.)
```

FUNCIONES DISPONIBLES:
- check_availability(property_id, check_in, check_out)
- calculate_price(property_id, check_in, check_out, guests)
- create_booking(booking_data)
- generate_payment_link(booking_id, amount)
- send_confirmation_email(booking_id)
- send_whatsapp_message(phone, message)

CRITERIO √âXITO:
‚úì 90% inquiries respondidas en < 5 minutos
‚úì 60% conversion rate (inquiry ‚Üí confirmed)
‚úì 0 double bookings
‚úì 100% confirmaciones enviadas autom√°ticamente

----------------------------
ü§ñ AGENTE 12: Revenue Manager Agent (Dynamic Pricing)
----------------------------

DESCRIPCI√ìN:
Agente que optimiza precios din√°micamente basado en demanda, competencia, eventos,
temporada y comportamiento del mercado para maximizar revenue y ocupaci√≥n.

CAPACIDADES:
‚úì Analizar demanda hist√≥rica
‚úì Detectar eventos locales (Nyepi, high season, festivales)
‚úì Monitorear competencia (scraping Airbnb/Booking)
‚úì Calcular precio √≥ptimo por d√≠a
‚úì Ajustar precios autom√°ticamente
‚úì Aplicar estrategias: last-minute, early-bird, long-stay
‚úì Generar reportes de performance

TECNOLOG√çA:
- Claude para an√°lisis y decisiones
- n8n para cron jobs diarios
- Supabase para pricing_rules y price_history
- Web scraping (opcional: Bright Data API)

TABLAS:

pricing_suggestions
- id (UUID, PK)
- property_id (UUID, FK)
- date (DATE)
- current_price (DECIMAL)
- suggested_price (DECIMAL)
- reason (TEXT) - explicaci√≥n del ajuste
- confidence (DECIMAL 0-1)
- applied (BOOLEAN)
- applied_at (TIMESTAMP)
- created_at (TIMESTAMP)

price_history
- property_id (UUID, FK)
- date (DATE)
- price (DECIMAL)
- occupancy (BOOLEAN)
- revenue (DECIMAL)
- created_at (TIMESTAMP)

L√ìGICA DE PRICING:

FACTORES QUE CONSIDERA:
1. Ocupaci√≥n hist√≥rica (misma fecha a√±o anterior)
2. Ocupaci√≥n actual pr√≥ximos 30 d√≠as
3. Lead time (cu√°nto falta para la fecha)
4. Eventos culturales/festivales
5. Temporada (alta/baja)
6. D√≠a de la semana (weekend premium)
7. Duraci√≥n de estancia (descuento long-stay)
8. Competencia (precios similares en la zona)

ESTRATEGIAS:

HIGH DEMAND (ocupaci√≥n > 80% pr√≥ximos 30 d√≠as):
- Aumentar precio +15-25%
- Priorizar profit sobre ocupaci√≥n

LOW DEMAND (ocupaci√≥n < 40%):
- Reducir precio -10-20%
- Ofrecer descuentos early-bird
- Priorizar ocupaci√≥n

LAST MINUTE (< 7 d√≠as):
- Descuento -15% si no hay booking
- Mejor ocupado con descuento que vac√≠o

LONG STAY (> 7 noches):
- Descuento progresivo: 7-13 nights (-10%), 14-27 (-15%), 28+ (-20%)

n8n WORKFLOW (Daily Pricing Update):
1. Cron: daily at 6am
2. Para cada property activa:
   - Calcular ocupaci√≥n next 30/60/90 d√≠as
   - Consultar eventos culturales
   - Analizar historical performance
   - Claude analiza factores y sugiere precios
   - Guardar suggestions en pricing_suggestions
3. Si confidence > 0.8 y change < 15%:
   - Aplicar autom√°ticamente
   - Actualizar prices en property
4. Si confidence < 0.8 o change > 15%:
   - Notificar owner para aprobaci√≥n manual

PROMPT SYSTEM (Revenue Manager):
```
Eres el Revenue Manager de MY HOST BizMate, experto en optimizaci√≥n de precios
para propiedades vacacionales en Bali.

OBJETIVO:
Maximizar revenue total anual manteniendo ocupaci√≥n √≥ptima (70-85%).

FILOSOF√çA:
- No siempre el precio m√°s alto es el mejor
- Balancear revenue vs. ocupaci√≥n
- Considerar costos de limpieza (mejor ocupaci√≥n larga que corta)
- Ser conservador (cambios graduales)

DATOS DISPONIBLES:
{property_base_price}
{occupancy_next_30_days}
{historical_occupancy_same_period}
{upcoming_cultural_events}
{competitor_prices}
{current_season}

TU AN√ÅLISIS DEBE INCLUIR:
1. Tendencia de demanda (alta/media/baja)
2. Precio recomendado (+/- % del base_price)
3. Raz√≥n del ajuste (2-3 bullets)
4. Confidence score (0-1)
5. Riesgos del ajuste

REGLAS:
- Nunca bajar > 30% del base_price
- Nunca subir > 50% del base_price
- Cambios graduales (m√°x 15% por semana)
- Respetar minimum_stay requirements
```

FUNCIONES DISPONIBLES:
- get_occupancy_stats(property_id, date_from, date_to)
- get_cultural_events(date_from, date_to)
- get_competitor_prices(location, date)
- get_booking_history(property_id, date_from, date_to)
- apply_price_change(property_id, date, new_price, reason)
- notify_owner_approval(property_id, suggestion_id)

CRITERIO √âXITO:
‚úì Revenue increase +20-30% vs. static pricing
‚úì Ocupaci√≥n mantener 70-85%
‚úì RevPAR (Revenue Per Available Room) increase +25%
‚úì 90% de sugerencias aceptadas por owners

========================================================================
FASE 3B: EXPANSI√ìN - 3 AGENTES IMPORTANTES (SEMANA 2)
========================================================================

----------------------------
ü§ñ AGENTE 5: Housekeeping Scheduler Agent
----------------------------

DESCRIPCI√ìN:
Coordina autom√°ticamente limpiezas entre check-outs y check-ins, asigna staff,
optimiza rutas, y gestiona inventario de supplies.

CAPACIDADES:
‚úì Detectar check-outs y crear task autom√°tica
‚úì Asignar staff basado en: disponibilidad, ubicaci√≥n, carga de trabajo
‚úì Optimizar rutas (m√∫ltiples propiedades mismo d√≠a)
‚úì Enviar notificaciones a staff (WhatsApp)
‚úì Tracking de status (pending ‚Üí in-progress ‚Üí completed)
‚úì Alertar si demora (check-in en 2h y a√∫n no completada)
‚úì Gestionar inventario (detectar cuando faltan supplies)

n8n WORKFLOW:
1. Trigger: booking.status = 'checked_out'
2. Calcular tiempo disponible (checkout ‚Üí next check-in)
3. Crear housekeeping_task en Supabase
4. Claude selecciona mejor staff:
   - Disponibilidad
   - Ubicaci√≥n (cerca de property)
   - Carga actual (no m√°s de 3 tasks/d√≠a)
   - Performance rating
5. Asignar task a staff
6. Enviar WhatsApp a staff:
   "Nueva limpieza: [Property Name], antes de [time]. Tap para confirmar."
7. Staff confirma ‚Üí status='in_progress'
8. Staff completa ‚Üí status='completed' + upload photos
9. Si demora (2h antes de next check-in y no completed):
   - Escalar a manager
   - Buscar staff backup

CRITERIO √âXITO:
‚úì 100% properties limpiadas a tiempo
‚úì 0 check-ins con property no ready
‚úì Tiempo promedio limpieza < 2.5h
‚úì Staff utilization 70-85%

----------------------------
ü§ñ AGENTE 3: Guest Manager Agent
----------------------------

DESCRIPCI√ìN:
Gestiona experiencia completa del hu√©sped desde pre-llegada hasta post-estancia,
automatizando comunicaciones, check-in/out, y solicitudes.

CAPACIDADES:
‚úì Bienvenida personalizada (pre-llegada)
‚úì Coordinar Digital Check-in
‚úì Enviar info √∫til durante estancia (d√≠a 2: recordar restaurant recommendation)
‚úì Gestionar solicitudes (extra towels, late checkout)
‚úì Check-out instructions (d√≠a antes)
‚úì Solicitar review (post check-out)
‚úì Thank you message + future discount

COMUNICACIONES AUTOM√ÅTICAS:

T-48h (Pre-llegada):
"Hi {guest_name}! üëã Your stay at {property_name} is in 2 days.
Please complete check-in: [link].
Arrival instructions: [details].
Questions? Just reply!"

T-0 (D√≠a llegada):
"Welcome to Bali! üå¥ Your access code: {code}.
WiFi: {wifi_ssid} / {password}.
Need anything? I'm here 24/7."

T+1 (Durante estancia):
"Hope you're enjoying {property_name}! üòä
Here are my top 3 restaurant recommendations nearby: [list].
Questions or need anything?"

T+3 (Mid-stay):
"Everything good? Any issues with the villa?
I'm here to help make your stay perfect!"

T-1 (Pre-checkout):
"Check-out tomorrow at {checkout_time}.
Instructions: [details].
Thank you for staying with us! üôè"

T+1 (Post-checkout):
"Thank you {guest_name}! üåü
We'd love your feedback: [review_link].
Come back soon! Use code RETURN10 for 10% off your next stay."

CRITERIO √âXITO:
‚úì 90% check-ins sin contacto humano
‚úì 50% solicitan recomendaciones proactivamente
‚úì 40% response rate en solicitud de review
‚úì 15% booking rate en return guests

----------------------------
ü§ñ AGENTE 8: Task Automation Agent
----------------------------

DESCRIPCI√ìN:
Orquestador maestro que detecta triggers y ejecuta workflows autom√°ticos,
coordinando entre todos los agentes y sistemas.

CAPACIDADES:
‚úì Detectar eventos en DB (new booking, checkout, payment, etc.)
‚úì Ejecutar workflows autom√°ticos
‚úì Coordinar entre agentes
‚úì Logging y error handling
‚úì Reportes de automaci√≥n

WORKFLOWS QUE ORQUESTA:

NEW BOOKING CONFIRMED:
‚Üí Enviar confirmaci√≥n (Booking Agent)
‚Üí Crear calendario entry (Calendar Agent)
‚Üí Programar check-in reminder (Guest Manager Agent)
‚Üí Calcular pricing impact (Revenue Manager)

CHECK-OUT DETECTED:
‚Üí Crear housekeeping task (Housekeeping Scheduler)
‚Üí Solicitar review (Guest Manager)
‚Üí Actualizar availability (Calendar Agent)
‚Üí Calcular revenue performance (Financial Manager)

PAYMENT RECEIVED:
‚Üí Actualizar booking status (Booking Manager)
‚Üí Enviar receipt (Financial Manager)
‚Üí Log transaction

CHECK-IN DELAYED (2h past arrival time):
‚Üí Send WhatsApp to guest
‚Üí Notify manager
‚Üí Update ETA

CRITERIO √âXITO:
‚úì 95% workflows ejecutados sin errores
‚úì 100% eventos cr√≠ticos detectados
‚úì < 1min latencia entre trigger y acci√≥n

========================================================================
FASE 3C: COMPLETO - 6 AGENTES COMPLEMENTARIOS (SEMANA 3-4)
========================================================================

Estos agentes se implementan despu√©s de validar MVP y expansi√≥n.

ü§ñ AGENTE 4: Calendar & Availability Agent
ü§ñ AGENTE 6: Maintenance Manager Agent
ü§ñ AGENTE 7: Staff Manager Agent
ü§ñ AGENTE 10: Multilingual Translation Agent
ü§ñ AGENTE 11: Financial Manager Agent (FMS)
ü§ñ AGENTE 1: PMS Core Agent (orquestador general)

Especificaci√≥n detallada de estos 6 agentes se proporciona cuando
se completen FASE 3A y 3B exitosamente.

========================================================================
INFRAESTRUCTURA GENERAL FASE 3
========================================================================

CLAUDE API:
- Modelo: Claude 3.5 Sonnet
- Rate limits: considerar en workflows
- Caching: cachear property info, knowledge base
- Costos: ~$3-6 per 1M tokens (Sonnet)

n8n WORKFLOWS:
- Self-hosted en Railway/Render (ya existe)
- Workflows por agente (modular)
- Error handling robusto
- Logging centralizado

SUPABASE:
- Database triggers para eventos
- Supabase Functions para l√≥gica compleja
- Realtime subscriptions para UI updates

WHATSAPP BUSINESS:
- Cloud API (oficial Facebook/Meta)
- Webhook setup en n8n
- Templates pre-aprobados para notificaciones
- Rate limits: 1000 mensajes/d√≠a (tier 1)

MONITOREO:
- Sentry para errors
- Logs en Supabase logs table
- Dashboard de m√©tricas IA:
  * Mensajes procesados
  * Accuracy rate
  * Tiempo respuesta
  * Escalamientos a humano
  * Satisfacci√≥n usuario

========================================================================
CRITERIOS DE √âXITO GLOBAL FASE 3
========================================================================

FASE 3A (MVP - 3 agentes):
‚úì WhatsApp Concierge atendiendo 80% consultas autom√°ticamente
‚úì Booking Agent procesando 60% inquiries ‚Üí confirmaci√≥n sin humano
‚úì Revenue Manager generando +20% revenue vs. static pricing
‚úì 100 conversaciones reales gestionadas
‚úì 50 bookings autom√°ticos creados
‚úì 0 errores cr√≠ticos

FASE 3B (Expansi√≥n - 6 agentes total):
‚úì Housekeeping 100% automatizado
‚úì Guest Manager gestionando journey completo
‚úì Task Automation orquestando todos los workflows
‚úì 500 conversaciones IA gestionadas
‚úì 200 bookings autom√°ticos
‚úì 95% satisfaction score hu√©spedes

FASE 3C (Completo - 12 agentes):
‚úì Sistema 90% aut√≥nomo
‚úì 5 propiedades operando full automated
‚úì Owner intervenci√≥n solo en casos excepcionales
‚úì Revenue increase +30-40% vs. gesti√≥n manual
‚úì Time saved: 25-30 horas/semana por propiedad

========================================================================
NEXT STEPS DESPU√âS DE FASE 3
========================================================================

1. Onboarding de propiedades reales (pilotos)
2. Refinamiento basado en feedback
3. Expansi√≥n a m√°s canales (Email, Instagram DM, etc.)
4. Integraciones: Airbnb/Booking APIs, PMS externos
5. Mobile app (opcional)
6. Marketplace de servicios locales (tours, transporte, chef privado)

FIN DEL PROMPT 3 - FASE 3
========================================================================
