{
  "name": "MY HOST - Booking Confirmation Flow (Emial=WhatsApp Chakra - MY HOST Bizmate VI)",
  "nodes": [
    {
      "parameters": {
        "httpMethod": "POST",
        "path": "booking-created",
        "options": {}
      },
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 2.1,
      "position": [
        -128,
        0
      ],
      "id": "d002c870-3cd4-4986-8b85-eeaa3867e5a4",
      "name": "Webhook",
      "webhookId": "63181f65-d8b0-4d0e-969e-b6e3e4ea9750"
    },
    {
      "parameters": {
        "operation": "get",
        "tableId": "properties",
        "filters": {
          "conditions": [
            {
              "keyName": "id",
              "keyValue": "={{ $node[\"Webhook\"].json[\"body\"][\"property_id\"] }}"
            }
          ]
        }
      },
      "type": "n8n-nodes-base.supabase",
      "typeVersion": 1,
      "position": [
        64,
        0
      ],
      "id": "62e604ee-7518-4dd5-a620-810580d1d5dc",
      "name": "Get a row",
      "credentials": {
        "supabaseApi": {
          "id": "SJLQzwU9BVHEVAGc",
          "name": "Supabase account"
        }
      }
    },
    {
      "parameters": {
        "resource": "mail",
        "fromEmail": "josecarrallodelafuente@gmail.com",
        "fromName": "MY HOST BizMate",
        "toEmail": "={{ $node[\"Webhook\"].json[\"body\"][\"guest_email\"] }}",
        "subject": "=‚úÖ Reserva Confirmada - {{ $('Get a row').item.json.name }}",
        "contentValue": "=¬°Hola {{ $node[\"Webhook\"].json[\"body\"][\"guest_name\"] }}!\n\nTu reserva ha sido confirmada exitosamente.\n\nDETALLES DE TU RESERVA:\n‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ\nüè† Propiedad: {{ $node[\"Get a row\"].json[\"name\"] }}\nüìç Ubicaci√≥n: {{ $node[\"Get a row\"].json[\"location\"] }}\nüìÖ Check-in: {{ $node[\"Webhook\"].json[\"body\"][\"check_in\"] }}\nüìÖ Check-out: {{ $node[\"Webhook\"].json[\"body\"][\"check_out\"] }}\nüë• Hu√©spedes: {{ $node[\"Webhook\"].json[\"body\"][\"guests_count\"] }}\nüí∞ Total: ${{ $node[\"Webhook\"].json[\"body\"][\"total_amount\"] }}\n\nPronto recibir√°s m√°s informaci√≥n sobre tu llegada.\n\n¬°Esperamos verte pronto!\n\nEl equipo de MY HOST BizMate üå∫",
        "additionalFields": {}
      },
      "type": "n8n-nodes-base.sendGrid",
      "typeVersion": 1,
      "position": [
        240,
        0
      ],
      "id": "b600da9b-43c7-4c10-ac47-a6eee83aad03",
      "name": "Send an email",
      "credentials": {
        "sendGridApi": {
          "id": "Y35BYbcV5SYfjBwc",
          "name": "SendGrid account"
        }
      }
    },
    {
      "parameters": {
        "method": "POST",
        "url": "=https://api.chakrahq.com/v1/ext/plugin/whatsapp/2e45a0bd-8600-41b4-ac92-599d59d6221c/api/v19.0/944855278702577/messages",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "Authorization",
              "value": "Bearer qiu1Z9eA3i2hhNjVM3Dm7QEK1Ey6iKQUE5IDWJlsFSAqXk5OlmQoD6DhqEwv9TOdgOVRWSYLWGxm6HfCs2LeCuwiU8Poqrw2Rgmvih0iEawZhoL6TTmMjVjvDUw2WuygAQgQ1vIeLCreDAKOGymGQCuR5bUYDHrRQQrvoMZLYwHw0LaGhFUuf4GxLpQbV3AQj8JDjhP2MzsCUYT4EVCARX6cODl1d1udr4pITGOmHQ793MUBtptq4XCvC8OGD3g"
            },
            {
              "name": "Content-Type",
              "value": "application/json"
            }
          ]
        },
        "sendBody": true,
        "contentType": "=json",
        "specifyBody": "json",
        "bodyParameters": {
          "parameters": [
            {}
          ]
        },
        "jsonBody": "={\n  \"messaging_product\": \"whatsapp\",\n  \"to\": \"{{ $node['Webhook'].json['body']['guest_phone'] }}\",\n  \"type\": \"text\",\n  \"text\": {\n    \"body\": \"‚úÖ *Reserva Confirmada*\\n\\nHola {{ $node['Webhook'].json['body']['guest_name'] }},\\n\\nüè† {{ $node['Get a row'].json['name'] }}\\nüìç {{ $node['Get a row'].json['location'] }}\\nüìÖ Check-in: {{ $node['Webhook'].json['body']['check_in'] }}\\nüìÖ Check-out: {{ $node['Webhook'].json['body']['check_out'] }}\\nüë• Hu√©spedes: {{ $node['Webhook'].json['body']['guests_count'] }}\\nüí∞ Total: ${{ $node['Webhook'].json['body']['total_amount'] }}\\n\\n¬°Te esperamos!\"\n  }\n}",
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.3,
      "position": [
        448,
        0
      ],
      "id": "520eed13-ce44-4010-bc44-f2731068aec1",
      "name": "HTTP Request"
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://api.chakrahq.com/v1/ext/plugin/whatsapp/2e45a0bd-8600-41b4-ac92-599d59d6221c/api/v19.0/944855278702577/messages",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "Authorization",
              "value": "Bearer qiu1Z9eA3i2hhNjVM3Dm7QEK1Ey6iKQUE5IDWJlsFSAqXk5OlmQoD6DhqEwv9TOdgOVRWSYLWGxm6HfCs2LeCuwiU8Poqrw2Rgmvih0iEawZhoL6TTmMjVjvDUw2WuygAQgQ1vIeLCreDAKOGymGQCuR5bUYDHrRQQrvoMZLYwHw0LaGhFUuf4GxLpQbV3AQj8JDjhP2MzsCUYT4EVCARX6cODl1d1udr4pITGOmHQ793MUBtptq4XCvC8OGD3g"
            }
          ]
        },
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={\n  \"messaging_product\": \"whatsapp\",\n  \"to\": \"34619794604\",\n  \"type\": \"text\",\n  \"text\": {\n    \"body\": \"üè® Nueva reserva en Izumi Hotel!\\n\\nüë§ Hu√©sped: {{ $('Webhook').item.json.body.guest_name }}\\nüìß Email: {{ $('Webhook').item.json.body.guest_email }}\\nüìÖ Check-in: {{ $('Webhook').item.json.body.check_in }}\\nüìÖ Check-out: {{ $('Webhook').item.json.body.check_out }}\\nüë• Hu√©spedes: {{ $('Webhook').item.json.body.guests_count }}\\nüí∞ Total: ${{ $('Webhook').item.json.body.total_amount }}\\n\\n‚úÖ Email de confirmaci√≥n enviado al hu√©sped.\"\n  }\n}",
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.3,
      "position": [
        656,
        0
      ],
      "id": "34ebb539-6887-4259-a363-bade7ba391cd",
      "name": "WhatsApp Propietario"
    }
  ],
  "pinData": {},
  "connections": {
    "Webhook": {
      "main": [
        [
          {
            "node": "Get a row",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get a row": {
      "main": [
        [
          {
            "node": "Send an email",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Send an email": {
      "main": [
        [
          {
            "node": "HTTP Request",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "HTTP Request": {
      "main": [
        [
          {
            "node": "WhatsApp Propietario",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "active": false,
  "settings": {
    "executionOrder": "v1"
  },
  "versionId": "d3088f3a-6a75-414b-8278-e476429b88da",
  "meta": {
    "templateCredsSetupCompleted": true,
    "instanceId": "ca7bc7f182c365457ea4a94a4dc2efe81c23590ab8904858ce5cabfbdd56e40f"
  },
  "id": "OxNTDO0yitqV6MAL",
  "tags": []
}