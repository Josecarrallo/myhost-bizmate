{
  "name": "MY HOST - Booking Confirmation Flow (Emial=WhatsApp Meta) FINAL",
  "nodes": [
    {
      "parameters": {
        "httpMethod": "POST",
        "path": "booking-created",
        "options": {}
      },
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 2.1,
      "position": [
        0,
        0
      ],
      "id": "d002c870-3cd4-4986-8b85-eeaa3867e5a4",
      "name": "Webhook",
      "webhookId": "63181f65-d8b0-4d0e-969e-b6e3e4ea9750"
    },
    {
      "parameters": {
        "operation": "get",
        "tableId": "properties",
        "filters": {
          "conditions": [
            {
              "keyName": "id",
              "keyValue": "={{ $node[\"Webhook\"].json[\"body\"][\"property_id\"] }}"
            }
          ]
        }
      },
      "type": "n8n-nodes-base.supabase",
      "typeVersion": 1,
      "position": [
        208,
        0
      ],
      "id": "62e604ee-7518-4dd5-a620-810580d1d5dc",
      "name": "Get a row",
      "credentials": {
        "supabaseApi": {
          "id": "SJLQzwU9BVHEVAGc",
          "name": "Supabase account"
        }
      }
    },
    {
      "parameters": {
        "resource": "mail",
        "fromEmail": "josecarrallodelafuente@gmail.com",
        "fromName": "MY HOST BizMate",
        "toEmail": "={{ $node[\"Webhook\"].json[\"body\"][\"guest_email\"] }}",
        "subject": "=‚úÖ Reserva Confirmada - {{ $('Get a row').item.json.name }}",
        "contentValue": "=¬°Hola {{ $node[\"Webhook\"].json[\"body\"][\"guest_name\"] }}!\n\nTu reserva ha sido confirmada exitosamente.\n\nDETALLES DE TU RESERVA:\n‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ\nüè† Propiedad: {{ $node[\"Get a row\"].json[\"name\"] }}\nüìç Ubicaci√≥n: {{ $node[\"Get a row\"].json[\"location\"] }}\nüìÖ Check-in: {{ $node[\"Webhook\"].json[\"body\"][\"check_in\"] }}\nüìÖ Check-out: {{ $node[\"Webhook\"].json[\"body\"][\"check_out\"] }}\nüë• Hu√©spedes: {{ $node[\"Webhook\"].json[\"body\"][\"guests_count\"] }}\nüí∞ Total: ${{ $node[\"Webhook\"].json[\"body\"][\"total_amount\"] }}\n\nPronto recibir√°s m√°s informaci√≥n sobre tu llegada.\n\n¬°Esperamos verte pronto!\n\nEl equipo de MY HOST BizMate üå∫",
        "additionalFields": {}
      },
      "type": "n8n-nodes-base.sendGrid",
      "typeVersion": 1,
      "position": [
        400,
        0
      ],
      "id": "b600da9b-43c7-4c10-ac47-a6eee83aad03",
      "name": "Send an email",
      "credentials": {
        "sendGridApi": {
          "id": "Y35BYbcV5SYfjBwc",
          "name": "SendGrid account"
        }
      }
    },
    {
      "parameters": {
        "method": "POST",
        "url": "=https://graph.facebook.com/v21.0/846885438510763/messages",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "Authorization",
              "value": "Bearer EAAVeake84yQBPZC5enVWHTNkCGOZB7ZBszmt9hrPaPyR4rzYoZBFcIe8qx2dOTYY13jx9uFL8ikSd5qzLE3wExM4uXPSZAlRdNYojG1PfJoorgC4CeuaLYmqWOd7yFBD4n7M0f4AS78DZB7ZC3NGdnuSPkgZB42iv71p7tFxph0G94reQ8uX5tiema8NR9IAyZCm9ng6J0T3bxKf7qCZChoGDHwJZCDcrMEMwQeFc0KZCwZB35NKqVyaAVHcfF8S875nt8zovHria5ZCHXi5rvjoiP1qkl"
            },
            {
              "name": "Content-Type",
              "value": "application/json"
            }
          ]
        },
        "sendBody": true,
        "contentType": "=json",
        "specifyBody": "json",
        "bodyParameters": {
          "parameters": [
            {}
          ]
        },
        "jsonBody": "{\n  \"messaging_product\": \"whatsapp\",\n  \"recipient_type\": \"individual\",\n  \"to\": \"34619794604\",\n  \"type\": \"text\",\n  \"text\": {\n    \"preview_url\": false,\n    \"body\": \"Prueba desde n8n + Meta API\"\n  }\n}",
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.3,
      "position": [
        608,
        0
      ],
      "id": "520eed13-ce44-4010-bc44-f2731068aec1",
      "name": "HTTP Request"
    }
  ],
  "pinData": {},
  "connections": {
    "Webhook": {
      "main": [
        [
          {
            "node": "Get a row",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get a row": {
      "main": [
        [
          {
            "node": "Send an email",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Send an email": {
      "main": [
        [
          {
            "node": "HTTP Request",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "HTTP Request": {
      "main": [
        []
      ]
    }
  },
  "active": true,
  "settings": {
    "executionOrder": "v1"
  },
  "versionId": "401b807d-265e-476c-83e2-207365a16d31",
  "meta": {
    "templateCredsSetupCompleted": true,
    "instanceId": "ca7bc7f182c365457ea4a94a4dc2efe81c23590ab8904858ce5cabfbdd56e40f"
  },
  "id": "OxNTDO0yitqV6MAL",
  "tags": []
}